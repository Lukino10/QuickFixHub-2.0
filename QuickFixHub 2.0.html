<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuickFixHub 2.0 - Soluzioni ai Problemi Quotidiani</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        /* Header */
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        /* Navigation */
        nav {
            background: #f8f9fa;
            padding: 0;
            display: flex;
            justify-content: center;
            border-bottom: 3px solid #667eea;
        }

        nav button {
            background: none;
            border: none;
            padding: 20px 30px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
            color: #333;
            font-weight: 500;
        }

        nav button:hover {
            background: #667eea;
            color: white;
        }

        nav button.active {
            background: #667eea;
            color: white;
            border-bottom: 4px solid #764ba2;
        }

        /* Main Content */
        .content {
            padding: 40px;
            min-height: 500px;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
        }

        .stat-card h3 {
            font-size: 2.5em;
            margin-bottom: 5px;
        }

        .stat-card p {
            opacity: 0.9;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            transition: border 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            min-height: 120px;
            resize: vertical;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 10px;
            font-size: 1.1em;
            cursor: pointer;
            transition: transform 0.2s;
            font-weight: 600;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        /* Problem/Solution Cards */
        .card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            border-left: 5px solid #667eea;
            transition: transform 0.2s;
        }

        .card:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .card h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .card .meta {
            display: flex;
            gap: 15px;
            margin-top: 15px;
            font-size: 0.9em;
            color: #666;
        }

        .badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .badge.verified {
            background: #10b981;
            color: white;
        }

        .badge.pending {
            background: #f59e0b;
            color: white;
        }

        .badge.category {
            background: #667eea;
            color: white;
        }

        /* Vote Buttons */
        .vote-section {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
        }

        .vote-btn {
            background: none;
            border: 2px solid #667eea;
            color: #667eea;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .vote-btn:hover {
            background: #667eea;
            color: white;
        }

        .vote-btn.upvoted {
            background: #10b981;
            border-color: #10b981;
            color: white;
        }

        .vote-btn.downvoted {
            background: #ef4444;
            border-color: #ef4444;
            color: white;
        }

        /* Leaderboard */
        .leaderboard-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 15px;
            transition: transform 0.2s;
        }

        .leaderboard-item:hover {
            transform: scale(1.02);
        }

        .leaderboard-item.rank-1 {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
        }

        .leaderboard-item.rank-2 {
            background: linear-gradient(135deg, #c0c0c0 0%, #e8e8e8 100%);
        }

        .leaderboard-item.rank-3 {
            background: linear-gradient(135deg, #cd7f32 0%, #e5a869 100%);
        }

        .rank {
            font-size: 2em;
            font-weight: 700;
            width: 60px;
            text-align: center;
        }

        .user-info {
            flex: 1;
            padding-left: 20px;
        }

        .user-info h4 {
            font-size: 1.2em;
            margin-bottom: 5px;
        }

        .points {
            font-size: 1.5em;
            font-weight: 700;
            color: #667eea;
        }

        /* Profile */
        .profile-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
        }

        .profile-header h2 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .profile-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

        .profile-stat {
            text-align: center;
        }

        .profile-stat h3 {
            font-size: 2em;
        }

        /* Filters */
        .filters {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 10px 20px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .filter-btn:hover,
        .filter-btn.active {
            background: #667eea;
            color: white;
        }

        /* AI Verification Badge */
        .ai-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            background: #10b981;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .ai-badge::before {
            content: "‚úì";
            font-weight: bold;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state h3 {
            font-size: 1.5em;
            margin-bottom: 10px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            nav {
                flex-wrap: wrap;
            }

            nav button {
                padding: 15px 20px;
                font-size: 0.9em;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .profile-stats {
                grid-template-columns: 1fr;
            }

            .search-container {
                padding: 15px 20px;
            }

            #globalSearch {
                font-size: 1em;
                padding: 12px 18px;
            }

            .search-results {
                left: 20px;
                right: 20px;
                top: 65px;
            }
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #10b981;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            display: none;
            z-index: 1000;
            animation: slideIn 0.3s;
        }

        @keyframes slideIn {
            from { transform: translateX(400px); }
            to { transform: translateX(0); }
        }

        .notification.show {
            display: block;
        }

        /* Search Bar */
        .search-container {
            padding: 20px 40px;
            background: white;
            border-bottom: 2px solid #e0e0e0;
            position: relative;
        }

        #globalSearch {
            width: 100%;
            padding: 15px 20px;
            font-size: 1.1em;
            border: 2px solid #e0e0e0;
            border-radius: 50px;
            transition: all 0.3s;
        }

        #globalSearch:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        .search-results {
            position: absolute;
            top: 70px;
            left: 40px;
            right: 40px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            max-height: 500px;
            overflow-y: auto;
            z-index: 100;
            display: none;
        }

        .search-results.show {
            display: block;
        }

        .search-result-item {
            padding: 20px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: background 0.2s;
        }

        .search-result-item:hover {
            background: #f8f9fa;
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        .search-result-type {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .search-result-type.problem {
            background: #fef3c7;
            color: #92400e;
        }

        .search-result-type.solution {
            background: #dbeafe;
            color: #1e40af;
        }

        .search-highlight {
            background: #fef08a;
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: 600;
        }

        .search-no-results {
            padding: 40px;
            text-align: center;
            color: #999;
        }

        .search-stats {
            padding: 15px 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
            font-size: 0.9em;
            color: #666;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="notification" id="notification"></div>

    <div class="container">
        <header>
            <h1>üîß QuickFixHub 2.0</h1>
            <p>Condividi problemi, scopri soluzioni verificate dall'AI</p>
        </header>

        <nav>
            <button class="nav-btn active" data-page="home">üè† Home</button>
            <button class="nav-btn" data-page="submit">‚ûï Inserisci</button>
            <button class="nav-btn" data-page="solutions">üîç Soluzioni</button>
            <button class="nav-btn" data-page="leaderboard">üèÜ Leaderboard</button>
            <button class="nav-btn" data-page="profile">üë§ Profilo</button>
        </nav>

        <div class="search-container">
            <input type="text" id="globalSearch" placeholder="üîç Cerca problemi, soluzioni, categorie..." onkeyup="performSearch()">
            <div id="searchResults" class="search-results"></div>
        </div>

        <div class="content">
            <!-- HOME PAGE -->
            <div class="page active" id="home">
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3 id="totalProblems">0</h3>
                        <p>Problemi Totali</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="totalSolutions">0</h3>
                        <p>Soluzioni Verificate</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="totalUsers">0</h3>
                        <p>Utenti Attivi</p>
                    </div>
                </div>

                <h2 style="margin-bottom: 20px; color: #333;">üî• Problemi Recenti</h2>
                <div id="recentProblems"></div>
            </div>

            <!-- SUBMIT PAGE -->
            <div class="page" id="submit">
                <h2 style="margin-bottom: 30px; color: #333;">Inserisci Problema o Soluzione</h2>
                
                <div class="form-group">
                    <label>Tipo</label>
                    <select id="submitType" onchange="toggleSubmitForm()">
                        <option value="problem">Problema</option>
                        <option value="solution">Soluzione</option>
                    </select>
                </div>

                <!-- Problem Form -->
                <div id="problemForm">
                    <div class="form-group">
                        <label>Titolo del Problema</label>
                        <input type="text" id="problemTitle" placeholder="es. Come rimuovere macchie di caff√®">
                    </div>

                    <div class="form-group">
                        <label>Descrizione</label>
                        <textarea id="problemDescription" placeholder="Descrivi il problema in dettaglio..."></textarea>
                    </div>

                    <div class="form-group">
                        <label>Categoria</label>
                        <select id="problemCategory">
                            <option value="casa">üè† Casa</option>
                            <option value="tech">üíª Tecnologia</option>
                            <option value="cucina">üç≥ Cucina</option>
                            <option value="auto">üöó Auto</option>
                            <option value="salute">‚ù§Ô∏è Salute</option>
                            <option value="altro">üìå Altro</option>
                        </select>
                    </div>

                    <button class="btn" onclick="submitProblem()">Pubblica Problema</button>
                </div>

                <!-- Solution Form -->
                <div id="solutionForm" style="display: none;">
                    <div class="form-group">
                        <label>Seleziona Problema</label>
                        <select id="solutionProblem"></select>
                    </div>

                    <div class="form-group">
                        <label>La Tua Soluzione</label>
                        <textarea id="solutionContent" placeholder="Descrivi la soluzione in modo chiaro e dettagliato..."></textarea>
                    </div>

                    <button class="btn" onclick="submitSolution()">Invia Soluzione (Verr√† Verificata dall'AI)</button>
                </div>
            </div>

            <!-- SOLUTIONS PAGE -->
            <div class="page" id="solutions">
                <h2 style="margin-bottom: 20px; color: #333;">üîç Esplora Soluzioni</h2>
                
                <div class="filters">
                    <button class="filter-btn active" data-filter="all" onclick="filterSolutions('all')">Tutte</button>
                    <button class="filter-btn" data-filter="verified" onclick="filterSolutions('verified')">‚úì Verificate</button>
                    <button class="filter-btn" data-filter="casa" onclick="filterSolutions('casa')">üè† Casa</button>
                    <button class="filter-btn" data-filter="tech" onclick="filterSolutions('tech')">üíª Tech</button>
                    <button class="filter-btn" data-filter="cucina" onclick="filterSolutions('cucina')">üç≥ Cucina</button>
                </div>

                <div id="solutionsList"></div>
            </div>

            <!-- LEADERBOARD PAGE -->
            <div class="page" id="leaderboard">
                <h2 style="margin-bottom: 30px; color: #333;">üèÜ Top Contributors</h2>
                <div id="leaderboardList"></div>
            </div>

            <!-- PROFILE PAGE -->
            <div class="page" id="profile">
                <div class="profile-header">
                    <h2 id="profileUsername">User123</h2>
                    <p id="profileBadge" style="font-size: 1.2em; margin-top: 10px;">ü•â Novizio</p>
                    <div class="profile-stats">
                        <div class="profile-stat">
                            <h3 id="profilePoints">0</h3>
                            <p>Punti</p>
                        </div>
                        <div class="profile-stat">
                            <h3 id="profileSolutions">0</h3>
                            <p>Soluzioni</p>
                        </div>
                        <div class="profile-stat">
                            <h3 id="profileVotes">0</h3>
                            <p>Voti Ricevuti</p>
                        </div>
                    </div>
                </div>

                <h3 style="margin-bottom: 20px; color: #333;">Le Tue Soluzioni</h3>
                <div id="userSolutions"></div>
            </div>
        </div>
    </div>

    <script>
        // Database Simulation (localStorage)
        class Database {
            constructor() {
                this.init();
            }

            init() {
                if (!localStorage.getItem('qfh_users')) {
                    localStorage.setItem('qfh_users', JSON.stringify([
                        { id: 1, username: 'Mario', points: 45, badge: 'Esperto', solutions: 5, votes: 12 },
                        { id: 2, username: 'Laura', points: 38, badge: 'Esperto', solutions: 4, votes: 10 },
                        { id: 3, username: 'Giovanni', points: 22, badge: 'Novizio', solutions: 2, votes: 6 }
                    ]));
                }

                if (!localStorage.getItem('qfh_problems')) {
                    localStorage.setItem('qfh_problems', JSON.stringify([
                        { id: 1, title: 'Come rimuovere macchie di caff√® dal tappeto', description: 'Ho versato caff√® sul tappeto bianco', category: 'casa', userId: 1, created: new Date().toISOString() },
                        { id: 2, title: 'PC lento all\'avvio', description: 'Il mio computer impiega 5 minuti ad avviarsi', category: 'tech', userId: 2, created: new Date().toISOString() }
                    ]));
                }

                if (!localStorage.getItem('qfh_solutions')) {
                    localStorage.setItem('qfh_solutions', JSON.stringify([
                        { id: 1, problemId: 1, userId: 2, content: 'Usa bicarbonato e aceto: cospargere bicarbonato, poi spruzzare aceto, lasciare agire 15 minuti e tamponare.', aiVerified: true, votes: 8, created: new Date().toISOString() },
                        { id: 2, problemId: 2, userId: 3, content: 'Disabilita programmi in avvio automatico tramite Task Manager > Avvio. Rimuovi quelli non necessari.', aiVerified: true, votes: 5, created: new Date().toISOString() }
                    ]));
                }

                if (!localStorage.getItem('qfh_currentUser')) {
                    localStorage.setItem('qfh_currentUser', JSON.stringify({ id: 1, username: 'Mario' }));
                }

                if (!localStorage.getItem('qfh_votes')) {
                    localStorage.setItem('qfh_votes', JSON.stringify([]));
                }
            }

            getUsers() { return JSON.parse(localStorage.getItem('qfh_users')); }
            setUsers(users) { localStorage.setItem('qfh_users', JSON.stringify(users)); }
            
            getProblems() { return JSON.parse(localStorage.getItem('qfh_problems')); }
            setProblems(problems) { localStorage.setItem('qfh_problems', JSON.stringify(problems)); }
            
            getSolutions() { return JSON.parse(localStorage.getItem('qfh_solutions')); }
            setSolutions(solutions) { localStorage.setItem('qfh_solutions', JSON.stringify(solutions)); }
            
            getCurrentUser() { return JSON.parse(localStorage.getItem('qfh_currentUser')); }
            
            getVotes() { return JSON.parse(localStorage.getItem('qfh_votes')); }
            setVotes(votes) { localStorage.setItem('qfh_votes', JSON.stringify(votes)); }
        }

        const db = new Database();

        // AI Verification Simulation
        function verifyWithAI(content) {
            // Simulazione: verifica se la soluzione contiene parole chiave affidabili
            const reliableKeywords = ['bicarbonato', 'aceto', 'task manager', 'disabilita', 'rimuovi', 
                                      'pulisci', 'verifica', 'controlla', 'usa', 'applica'];
            const hasKeywords = reliableKeywords.some(keyword => content.toLowerCase().includes(keyword));
            const isLongEnough = content.length > 30;
            
            return hasKeywords && isLongEnough;
        }

        // Navigation
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const page = btn.dataset.page;
                
                document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                document.getElementById(page).classList.add('active');
                
                if (page === 'home') loadHome();
                if (page === 'solutions') loadSolutions();
                if (page === 'leaderboard') loadLeaderboard();
                if (page === 'profile') loadProfile();
                if (page === 'submit') loadSubmitPage();
            });
        });

        // Toggle Submit Form
        function toggleSubmitForm() {
            const type = document.getElementById('submitType').value;
            document.getElementById('problemForm').style.display = type === 'problem' ? 'block' : 'none';
            document.getElementById('solutionForm').style.display = type === 'solution' ? 'block' : 'none';
        }

        // Load Submit Page
        function loadSubmitPage() {
            const problems = db.getProblems();
            const select = document.getElementById('solutionProblem');
            select.innerHTML = problems.map(p => 
                `<option value="${p.id}">${p.title}</option>`
            ).join('');
        }

        // Submit Problem
        function submitProblem() {
            const title = document.getElementById('problemTitle').value;
            const description = document.getElementById('problemDescription').value;
            const category = document.getElementById('problemCategory').value;
            
            if (!title || !description) {
                showNotification('Compila tutti i campi!', 'error');
                return;
            }

            const problems = db.getProblems();
            const currentUser = db.getCurrentUser();
            
            const newProblem = {
                id: problems.length + 1,
                title,
                description,
                category,
                userId: currentUser.id,
                created: new Date().toISOString()
            };
            
            problems.push(newProblem);
            db.setProblems(problems);
            
            document.getElementById('problemTitle').value = '';
            document.getElementById('problemDescription').value = '';
            
            showNotification('Problema pubblicato con successo!');
            
            // Update stats
            const users = db.getUsers();
            const user = users.find(u => u.id === currentUser.id);
            user.points += 5;
            db.setUsers(users);
        }

        // Submit Solution
        function submitSolution() {
            const problemId = parseInt(document.getElementById('solutionProblem').value);
            const content = document.getElementById('solutionContent').value;
            
            if (!content) {
                showNotification('Scrivi una soluzione!', 'error');
                return;
            }

            const solutions = db.getSolutions();
            const currentUser = db.getCurrentUser();
            
            // AI Verification
            const aiVerified = verifyWithAI(content);
            
            const newSolution = {
                id: solutions.length + 1,
                problemId,
                userId: currentUser.id,
                content,
                aiVerified,
                votes: 0,
                created: new Date().toISOString()
            };
            
            solutions.push(newSolution);
            db.setSolutions(solutions);
            
            document.getElementById('solutionContent').value = '';
            
            if (aiVerified) {
                showNotification('‚úì Soluzione verificata dall\'AI e pubblicata!');
                
                // Update user points
                const users = db.getUsers();
                const user = users.find(u => u.id === currentUser.id);
                user.points += 10;
                user.solutions = (user.solutions || 0) + 1;
                updateBadge(user);
                db.setUsers(users);
            } else {
                showNotification('‚ö†Ô∏è Soluzione pubblicata ma non verificata dall\'AI. Aggiungi pi√π dettagli!', 'warning');
            }
        }

        // Update Badge
        function updateBadge(user) {
            if (user.points >= 50) user.badge = 'Guru';
            else if (user.points >= 30) user.badge = 'Esperto';
            else user.badge = 'Novizio';
        }

        // Load Home
        function loadHome() {
            const problems = db.getProblems();
            const solutions = db.getSolutions();
            const users = db.getUsers();
            
            document.getElementById('totalProblems').textContent = problems.length;
            document.getElementById('totalSolutions').textContent = solutions.filter(s => s.aiVerified).length;
            document.getElementById('totalUsers').textContent = users.length;
            
            const recentProblems = problems.slice(-5).reverse();
            const container = document.getElementById('recentProblems');
            
            if (recentProblems.length === 0) {
                container.innerHTML = '<div class="empty-state"><h3>Nessun problema ancora</h3><p>Sii il primo a condividere!</p></div>';
                return;
            }
            
            container.innerHTML = recentProblems.map(p => {
                const user = users.find(u => u.id === p.userId);
                const solutionsCount = solutions.filter(s => s.problemId === p.id).length;
                
                return `
                    <div class="card">
                        <span class="badge category">${getCategoryIcon(p.category)} ${p.category}</span>
                        <h3>${p.title}</h3>
                        <p>${p.description}</p>
                        <div class="meta">
                            <span>üë§ ${user.username}</span>
                            <span>üí° ${solutionsCount} soluzioni</span>
                            <span>üìÖ ${formatDate(p.created)}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Load Solutions
        let currentFilter = 'all';

        function filterSolutions(filter) {
            currentFilter = filter;
            
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.filter === filter) btn.classList.add('active');
            });
            
            loadSolutions();
        }

        function loadSolutions() {
            let solutions = db.getSolutions();
            const problems = db.getProblems();
            const users = db.getUsers();
            const currentUser = db.getCurrentUser();
            const userVotes = db.getVotes();
            
            if (currentFilter === 'verified') {
                solutions = solutions.filter(s => s.aiVerified);
            } else if (currentFilter !== 'all') {
                solutions = solutions.filter(s => {
                    const problem = problems.find(p => p.id === s.problemId);
                    return problem && problem.category === currentFilter;
                });
            }
            
            solutions.sort((a, b) => b.votes - a.votes);
            
            const container = document.getElementById('solutionsList');
            
            if (solutions.length === 0) {
                container.innerHTML = '<div class="empty-state"><h3>Nessuna soluzione trovata</h3></div>';
                return;
            }
            
            container.innerHTML = solutions.map(s => {
                const problem = problems.find(p => p.id === s.problemId);
                const user = users.find(u => u.id === s.userId);
                const userVote = userVotes.find(v => v.solutionId === s.id && v.userId === currentUser.id);
                
                return `
                    <div class="card">
                        ${s.aiVerified ? '<span class="ai-badge">AI Verificata</span>' : '<span class="badge pending">In Revisione</span>'}
                        <span class="badge category" style="margin-left: 10px;">${getCategoryIcon(problem.category)} ${problem.category}</span>
                        <h3>Problema: ${problem.title}</h3>
                        <p style="margin-top: 10px;"><strong>Soluzione:</strong> ${s.content}</p>
                        <div class="meta">
                            <span>üë§ ${user.username}</span>
                            <span>üìÖ ${formatDate(s.created)}</span>
                        </div>
                        <div class="vote-section">
                            <button class="vote-btn ${userVote?.type === 'up' ? 'upvoted' : ''}" 
                                    onclick="vote(${s.id}, 'up')">üëç ${s.votes}</button>
                            <button class="vote-btn ${userVote?.type === 'down' ? 'downvoted' : ''}" 
                                    onclick="vote(${s.id}, 'down')">üëé</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Vote System
        function vote(solutionId, type) {
            const currentUser = db.getCurrentUser();
            const votes = db.getVotes();
            const solutions = db.getSolutions();
            const users = db.getUsers();
            
            const existingVote = votes.find(v => v.solutionId === solutionId && v.userId === currentUser.id);
            
            if (existingVote) {
                if (existingVote.type === type) {
                    // Remove vote
                    const index = votes.indexOf(existingVote);
                    votes.splice(index, 1);
                    
                    const solution = solutions.find(s => s.id === solutionId);
                    solution.votes += type === 'up' ? -1 : 1;
                    
                    // Update solution author points
                    const author = users.find(u => u.id === solution.userId);
                    author.points += type === 'up' ? -2 : 2;
                    author.votes = (author.votes || 0) - 1;
                } else {
                    // Change vote
                    existingVote.type = type;
                    
                    const solution = solutions.find(s => s.id === solutionId);
                    solution.votes += type === 'up' ? 2 : -2;
                    
                    const author = users.find(u => u.id === solution.userId);
                    author.points += type === 'up' ? 4 : -4;
                }
            } else {
                // New vote
                votes.push({ solutionId, userId: currentUser.id, type });
                
                const solution = solutions.find(s => s.id === solutionId);
                solution.votes += type === 'up' ? 1 : -1;
                
                // Update solution author points
                const author = users.find(u => u.id === solution.userId);
                author.points += type === 'up' ? 2 : -2;
                author.votes = (author.votes || 0) + 1;
                updateBadge(author);
            }
            
            db.setVotes(votes);
            db.setSolutions(solutions);
            db.setUsers(users);
            
            loadSolutions();
        }

        // Load Leaderboard
        function loadLeaderboard() {
            const users = db.getUsers().sort((a, b) => b.points - a.points);
            const container = document.getElementById('leaderboardList');
            
            container.innerHTML = users.map((user, index) => {
                const rank = index + 1;
                const badge = rank === 1 ? 'ü•á' : rank === 2 ? 'ü•à' : rank === 3 ? 'ü•â' : '';
                
                return `
                    <div class="leaderboard-item rank-${rank <= 3 ? rank : ''}">
                        <div class="rank">${badge || rank}</div>
                        <div class="user-info">
                            <h4>${user.username}</h4>
                            <p>${user.badge}</p>
                        </div>
                        <div class="points">${user.points} pts</div>
                    </div>
                `;
            }).join('');
        }

        // Load Profile
        function loadProfile() {
            const currentUser = db.getCurrentUser();
            const users = db.getUsers();
            const user = users.find(u => u.id === currentUser.id);
            const solutions = db.getSolutions().filter(s => s.userId === currentUser.id);
            const problems = db.getProblems();
            
            document.getElementById('profileUsername').textContent = user.username;
            document.getElementById('profileBadge').textContent = getBadgeIcon(user.badge) + ' ' + user.badge;
            document.getElementById('profilePoints').textContent = user.points;
            document.getElementById('profileSolutions').textContent = user.solutions || 0;
            document.getElementById('profileVotes').textContent = user.votes || 0;
            
            const container = document.getElementById('userSolutions');
            
            if (solutions.length === 0) {
                container.innerHTML = '<div class="empty-state"><h3>Non hai ancora pubblicato soluzioni</h3></div>';
                return;
            }
            
            container.innerHTML = solutions.map(s => {
                const problem = problems.find(p => p.id === s.problemId);
                
                return `
                    <div class="card">
                        ${s.aiVerified ? '<span class="ai-badge">AI Verificata</span>' : '<span class="badge pending">In Revisione</span>'}
                        <h3>${problem.title}</h3>
                        <p>${s.content}</p>
                        <div class="meta">
                            <span>üëç ${s.votes} voti</span>
                            <span>üìÖ ${formatDate(s.created)}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Helper Functions
        function getCategoryIcon(category) {
            const icons = {
                casa: 'üè†',
                tech: 'üíª',
                cucina: 'üç≥',
                auto: 'üöó',
                salute: '‚ù§Ô∏è',
                altro: 'üìå'
            };
            return icons[category] || 'üìå';
        }

        function getBadgeIcon(badge) {
            const icons = {
                'Novizio': 'ü•â',
                'Esperto': 'ü•à',
                'Guru': 'ü•á'
            };
            return icons[badge] || 'ü•â';
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diff = now - date;
            const hours = Math.floor(diff / 3600000);
            
            if (hours < 1) return 'Adesso';
            if (hours < 24) return `${hours}h fa`;
            return `${Math.floor(hours / 24)}g fa`;
        }

        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.background = type === 'error' ? '#ef4444' : type === 'warning' ? '#f59e0b' : '#10b981';
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Initialize
        loadHome();

        // Search Functionality
        let searchTimeout;

        function performSearch() {
            clearTimeout(searchTimeout);
            
            searchTimeout = setTimeout(() => {
                const query = document.getElementById('globalSearch').value.trim();
                const resultsContainer = document.getElementById('searchResults');
                
                if (query.length < 2) {
                    resultsContainer.classList.remove('show');
                    return;
                }
                
                const problems = db.getProblems();
                const solutions = db.getSolutions();
                const users = db.getUsers();
                
                let results = [];
                
                // Search in problems
                problems.forEach(problem => {
                    const titleMatch = problem.title.toLowerCase().includes(query.toLowerCase());
                    const descMatch = problem.description.toLowerCase().includes(query.toLowerCase());
                    const categoryMatch = problem.category.toLowerCase().includes(query.toLowerCase());
                    
                    if (titleMatch || descMatch || categoryMatch) {
                        const user = users.find(u => u.id === problem.userId);
                        results.push({
                            type: 'problem',
                            id: problem.id,
                            title: highlightText(problem.title, query),
                            description: highlightText(problem.description, query),
                            category: problem.category,
                            user: user.username,
                            relevance: titleMatch ? 3 : (descMatch ? 2 : 1)
                        });
                    }
                });
                
                // Search in solutions
                solutions.forEach(solution => {
                    const contentMatch = solution.content.toLowerCase().includes(query.toLowerCase());
                    
                    if (contentMatch) {
                        const problem = problems.find(p => p.id === solution.problemId);
                        const user = users.find(u => u.id === solution.userId);
                        
                        results.push({
                            type: 'solution',
                            id: solution.id,
                            problemTitle: problem.title,
                            content: highlightText(solution.content, query),
                            aiVerified: solution.aiVerified,
                            votes: solution.votes,
                            user: user.username,
                            category: problem.category,
                            relevance: 2
                        });
                    }
                });
                
                // Sort by relevance
                results.sort((a, b) => b.relevance - a.relevance);
                
                // Display results
                if (results.length === 0) {
                    resultsContainer.innerHTML = `
                        <div class="search-no-results">
                            <h3>üòï Nessun risultato</h3>
                            <p>Prova con altri termini di ricerca</p>
                        </div>
                    `;
                } else {
                    resultsContainer.innerHTML = `
                        <div class="search-stats">
                            Trovati ${results.length} risultat${results.length === 1 ? 'o' : 'i'} per "${query}"
                        </div>
                        ${results.map(result => renderSearchResult(result)).join('')}
                    `;
                }
                
                resultsContainer.classList.add('show');
            }, 300);
        }

        function renderSearchResult(result) {
            if (result.type === 'problem') {
                return `
                    <div class="search-result-item" onclick="goToSolutions('${result.category}')">
                        <div>
                            <span class="search-result-type problem">üìã Problema</span>
                            <span class="badge category">${getCategoryIcon(result.category)} ${result.category}</span>
                        </div>
                        <h4 style="margin: 8px 0; color: #333;">${result.title}</h4>
                        <p style="color: #666; font-size: 0.95em;">${truncate(result.description, 100)}</p>
                        <p style="margin-top: 8px; font-size: 0.85em; color: #999;">üë§ ${result.user}</p>
                    </div>
                `;
            } else {
                return `
                    <div class="search-result-item" onclick="goToSolutions('${result.category}')">
                        <div>
                            <span class="search-result-type solution">üí° Soluzione</span>
                            ${result.aiVerified ? '<span class="ai-badge" style="font-size: 0.75em;">AI Verificata</span>' : ''}
                            <span class="badge category">${getCategoryIcon(result.category)} ${result.category}</span>
                        </div>
                        <h4 style="margin: 8px 0; color: #333;">Per: ${result.problemTitle}</h4>
                        <p style="color: #666; font-size: 0.95em;">${truncate(result.content, 120)}</p>
                        <div style="margin-top: 8px; font-size: 0.85em; color: #999;">
                            <span>üë§ ${result.user}</span>
                            <span style="margin-left: 15px;">üëç ${result.votes}</span>
                        </div>
                    </div>
                `;
            }
        }

        function highlightText(text, query) {
            const regex = new RegExp(`(${escapeRegex(query)})`, 'gi');
            return text.replace(regex, '<span class="search-highlight">$1</span>');
        }

        function escapeRegex(str) {
            return str.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }

        function truncate(text, length) {
            const div = document.createElement('div');
            div.innerHTML = text;
            const plainText = div.textContent || div.innerText;
            
            if (plainText.length <= length) return text;
            return text.substring(0, length) + '...';
        }

        function goToSolutions(category) {
            document.getElementById('searchResults').classList.remove('show');
            document.getElementById('globalSearch').value = '';
            
            // Navigate to solutions page
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.querySelector('[data-page="solutions"]').classList.add('active');
            
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('solutions').classList.add('active');
            
            // Apply filter
            filterSolutions(category);
        }

        // Close search results when clicking outside
        document.addEventListener('click', function(e) {
            const searchContainer = document.querySelector('.search-container');
            const searchResults = document.getElementById('searchResults');
            
            if (!searchContainer.contains(e.target)) {
                searchResults.classList.remove('show');
            }
        });
    </script>
</body>
</html>